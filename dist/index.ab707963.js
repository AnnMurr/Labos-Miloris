var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},r={},s=t.parcelRequired8bb;null==s&&((s=function(t){if(t in e)return e[t].exports;if(t in r){var s=r[t];delete r[t];var a={id:t,exports:{}};return e[t]=a,s.call(a.exports,a,a.exports),a.exports}var n=Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){r[t]=e},t.parcelRequired8bb=s);const a=document.querySelector(".burger"),n=document.querySelector(".submenu"),o=document.querySelector(".cross");function i(t){n.contains(t.target)||o.contains(t.target)||a.contains(t.target)||(n.style.display="none",document.removeEventListener("click",i))}a.addEventListener("click",function(){"none"===n.style.display?(n.style.display="block",document.addEventListener("click",i)):(n.style.display="none",document.removeEventListener("click",i))}),o.addEventListener("click",function(){o.parentNode.parentNode.style.display="none"}),s("lp9Cw"),s("9bEHj"),s("fvBqw");var c=s("fEuAQ");const l=[{tag:"input",class:"registration__input",id:"city",attributes:[{type:"text"},{placeholder:"Город"},{list:"city-list"},{autocomplete:"address-level2"},{"data-input":"city"}]},{tag:"datalist",id:"city-list"},{tag:"span",class:["error-message"],id:"error-city",attributes:[{"data-error":"city"}]},{tag:"input",class:"registration__input",attributes:[{type:"text"},{placeholder:"Имя"},{autocomplete:"given-name"},{"data-input":"name"}]},{tag:"span",class:["error-message"],id:"error-name",attributes:[{"data-error":"name"}]},{tag:"input",id:"birthday",class:"registration__input",attributes:[{type:"date"},{placeholder:"Дата рождения"},{autocomplete:"bday"},{name:"trip-start"},{min:"1900-01-01"},{"data-input":"date"}]},{tag:"span",class:["error-message"],id:"error-date",attributes:[{"data-error":"date"}]},{tag:"input",class:"registration__input",attributes:[{type:"email"},{placeholder:"Почта"},{autocomplete:"email"},{"data-input":"email"}]},{tag:"span",class:["error-message"],id:"error-email",attributes:[{"data-error":"email"}]},{tag:"input",class:"registration__input",attributes:[{type:"password"},{placeholder:"Пароль"},{autocomplete:"current-password"},{"data-input":"password-1"}]},{tag:"button",class:"btn-show-password",attributes:[{"data-password":"password-1"},{type:"button"}],content:"\uD83D\uDC41"},{tag:"span",id:"error-password",class:["error-message"],attributes:[{"data-error":"password-1"}]},{tag:"input",class:"registration__input",attributes:[{type:"password"},{placeholder:"Введите пароль еще раз"},{autocomplete:"current-password"},{"data-input":"password-2"}]},{tag:"button",class:"btn-show-password",attributes:[{"data-password":"password-2"},{type:"button"}],content:"\uD83D\uDC41"},{tag:"span",class:["error-message"],attributes:[{"data-error":"password-2"}]},{tag:"input",id:"registration__checkbox",class:["registration__input","registration__checkbox"],attributes:[{type:"checkbox"},{"data-input":"checkbox"}]},{tag:"a",class:["registration__label"],content:"Согласен с политикой конфиденциальности"},{tag:"span",class:["error-message"],attributes:[{"data-error":"checkbox"}]},{tag:"button",class:["btn","registration__button"],content:"Зарегистрироваться",attributes:[{type:"submit"}]}];class d{static passwordDossNotMatch=`Пароль не совпадает`;static passwordIncorrectLength=`Пароль должен содержать не менее 6 символов и одну заглавную букву`;static chooseAnotherCity="Выберите другой город";static whiteSpace="Строки не должны содержать пробелы";static invalidEmail="Неправильно введенный e-mail";static errorMessageMaxQuantity(t,e,r){t.textContent=`Имя не должно содержать ${r}
Максимальное кол-во ${e} символов`}static errorMessageExistingLogin(t,e){t.textContent=`Пользователь ${e} уже существует`}static setErrorMessage(t,e){t.textContent=e}}class u{static userUrl="https://64901aaa1e6aa71680ca93bb.mockapi.io/user";static setUserData(t,e,r,s,a,n,o){return new Promise((i,c)=>{fetch(this.userUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:t,password:e,token:r,city:s,name:a,date:n,orders:o})}).then(t=>{t.ok?i():c()}).catch(t=>{throw t})})}static async changeUserOrders(t,e){let r=await this.getUserToken(t),s=r.id;return r.orders=e,fetch(`${this.userUrl}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t=>{if(t.ok)return t.json();throw Error("Failed to change user data")}).catch(t=>{throw t})}static getUserData(t){return fetch(this.userUrl).then(t=>t.json()).then(e=>e.find(e=>e.login===t)).catch(t=>{throw t})}static getUserLogin(t){return fetch(this.userUrl).then(t=>t.json()).then(e=>e.find(e=>e.login===t)).catch(t=>{throw t})}static getUserToken(t){return fetch(this.userUrl).then(t=>t.json()).then(e=>e.find(e=>e.token.toString()===t)).catch(t=>{throw t})}}class m{static specialSymbolsArray=/[!@#$%^&*()[\]{}|\\;:'"<>.,\/?`~=+\-№_]/;static specialSymbols="!@#$%^&*()-_+={}[]|\\;:'\"<>.,/?`~№";static maxNumberOfLettersName=20;static maxNumberOfLettersEmail=40;static minNumberOfLettersPasswords=6;static token=Math.random()*new Date;static successRegistration="Регистрация прошла успешно"}var p=s("iOt5K"),g=(s("lkGsD"),s("lkGsD"));class h{static signOut="Выйти из акаунта";static signIn="Войти";static welcomeUser=t=>`Добро пожаловать, ${t}`;static welcome="Добро пожаловать!"}var y=s("d12Qx"),g=s("lkGsD");function w(){let t=(0,g.UserStore).getUserToken(),e=document.querySelector(".authentication__sign-up");t?e.style.display="none":e.style.display="block"}w();const f=document.querySelector(".user"),b=document.querySelector(".user__modal");function _(){b.classList.remove("user__modal_active"),v()}function v(){let t=b.classList.contains("user__modal_active");t?document.addEventListener("click",E):document.removeEventListener("click",E)}function E(t){b.contains(t.target)||f.contains(t.target)||b.classList.remove("user__modal_active"),b.classList.contains("user__modal_active")||document.removeEventListener("click",E)}async function L(){b.innerHTML=null;let t=(0,g.UserStore).getUserToken(),e=await u.getUserToken(t);t?S(h.welcomeUser(e.name),h.signOut):S(h.welcome,h.signIn)}function S(t,e){b.append(function(t){let e=document.createElement("div");e.classList.add("modal-header");let r=document.createElement("div");r.classList.add("modal-header__heading");let s=document.createElement("h5");s.textContent=t;let a=document.createElement("button");return a.classList.add("cross"),a.type="button",a.addEventListener("click",_),r.append(s),e.append(r,a),e}(t),function(t=h.signOut){let e=document.createElement("button");return e.classList.add("btn","user__btn-exit"),e.textContent=t,e.addEventListener("click",k),e}(e))}async function k(){let t=(0,g.UserStore).getUserToken(),e=(0,y.Basket_Store).basketStoreData(),r=await u.getUserToken(t);if(t)u.changeUserOrders(r.token.toString(),e),w(),setTimeout(()=>void((0,g.UserStore).removeUserToken(),(0,y.Basket_Store).setCardToStore([]),location.reload()),1e3);else{let t=document.getElementById("authentication");t.scrollIntoView({behavior:"smooth"}),b.classList.remove("user__modal_active")}}f.addEventListener("click",function(){b.classList.toggle("user__modal_active"),v()}),document.addEventListener("DOMContentLoaded",L);var y=s("d12Qx");const x=document.querySelector(".registration"),U=document.querySelector(".authentication__sign-up");function q(t){t.preventDefault(),T()}function C(){let t=document.querySelector(".registration__label"),e=window.location.href;t.href="http://localhost:1234/index.html"===e?"./pages/privacy-policy.html":"./privacy-policy.html"}U.addEventListener("click",function(){let t="registration_active";x.classList.contains(t)?x.classList.remove(t):x.classList.add(t)});const D=t=>{let e=[];return t.forEach(t=>{let r=t.getAttribute("data-input"),s=document.querySelector(`[data-error="${r}"]`);"checkbox"!==r||t.checked?""===t.value?(s.textContent="Поле должно быть заполнено",e.push(!1)):e.push(!0):(s.textContent="Подтвердите согласие",e.push(!1))}),e};async function T(){!function(){let t=document.querySelectorAll(".error-message");t.forEach(t=>t.textContent=null)}();let t=Array.from(document.querySelectorAll(".registration__input")),e=t.map(t=>t.value),[r,s,a,n,o,i]=e,l=document.getElementById("error-city"),h=document.getElementById("error-name"),f=document.getElementById("error-email"),b=document.querySelector('[data-error="password-1"]'),_=await u.getUserLogin(n),v=(0,y.Basket_Store).basketStoreData();D(t).includes(!1)?D(t):(0,c.CITIES).includes(r)?s.includes(" ")?d.setErrorMessage(h,d.whiteSpace):n.includes(" ")?d.setErrorMessage(f,d.whiteSpace):o.includes(" ")?d.setErrorMessage(b,d.whiteSpace):s.length>m.maxNumberOfLettersName||s.match(m.specialSymbolsArray)?d.errorMessageMaxQuantity(h,m.maxNumberOfLettersName,m.specialSymbols):/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(n)?n.length>m.maxNumberOfLettersEmail?d.errorMessageMaxQuantity(f,m.maxNumberOfLettersEmail):_?d.errorMessageExistingLogin(f,n):o!==i?d.setErrorMessage(b,d.passwordDossNotMatch):o.length<m.minNumberOfLettersPasswords||!o.match(/[A-ZА-Я]/i)?d.setErrorMessage(b,d.passwordIncorrectLength):(u.setUserData(n,o,m.token,r,s,a,v),(0,p.AlertService).success(m.successRegistration),(0,g.UserStore).setUserToken(m.token),w(),setTimeout(()=>{L(),location.reload()},4e3)):d.setErrorMessage(f,d.invalidEmail):d.setErrorMessage(l,d.chooseAnotherCity)}document.addEventListener("DOMContentLoaded",function(){!function(){let t=document.createElement("div");t.classList.add("registration__wrapper"),t.append(function(){let t=document.createElement("div");return t.classList.add("registration__image-inner"),t}(),function(){let t=document.createElement("form");return t.classList.add("registration__form"),l.forEach(e=>{var r;let s=document.createElement(e.tag);if(Array.isArray(e.class)&&e.class.length>0?e.class.forEach(t=>s.classList.add(t)):e.class&&s.classList.add(e.class),e.attributes&&e.attributes.length>0&&e.attributes.forEach(t=>{let[e,r]=Object.entries(t)[0];s.setAttribute(e,r)}),e.id&&"city-list"===e.id?(s.id=e.id,r=s,(0,c.CITIES).forEach(t=>{let e=document.createElement("option");e.textContent=t,r.appendChild(e)})):e.id&&(s.id=e.id),"date"===s.getAttribute("type")){s.addEventListener("keydown",function(t){t.preventDefault()});let t=new Date;t.setFullYear(t.getFullYear()-18),s.setAttribute("max",t.toISOString().split("T")[0])}e.content&&(s.textContent=e.content),t.append(s)}),t}()),x.append(t),t.querySelector(".registration__label").addEventListener("click",C),document.querySelector(".registration__button").addEventListener("click",q)}(),function(){let t=document.querySelector('[data-input="password-1"]'),e=document.querySelector('[data-input="password-2"]'),r=document.querySelector('[data-password="password-1"]'),s=document.querySelector('[data-password="password-2"]'),a=document.querySelectorAll(".btn-show-password");a.forEach(a=>{a.addEventListener("click",function(a){let n="btn-show-password_show",o="password-1"===a.target.getAttribute("data-password"),i=o?t:e;i.type="password"===i.type?"text":"password";let c=o?r:s;c.classList.contains(n)?c.classList.remove(n):c.classList.add(n)})})}()});var p=s("iOt5K"),g=s("lkGsD"),y=s("d12Qx");const O=document.querySelector(".signIn__input-login"),M=document.querySelector(".signIn__inputp-password"),A=document.querySelector(".authentication .form .btn"),N=document.querySelector(".authentication .form");async function I(){B();let t=await u.getUserData(O.value),e=document.querySelector('[data-error-log="login"]'),r=document.querySelector('[data-error-log="password"]'),s=(0,g.UserStore).getUserToken();s?(0,p.AlertService).error("Выйдите из аккаунта"):t?t.password!==M.value?r.textContent="Неверный пароль":((0,p.AlertService).success("Вы вошли в аккаунт"),w(),(0,g.UserStore).setUserToken(t.token),L(),N.reset(),B(),(0,y.Basket_Store).setCardToStore(t.orders)):e.textContent="Пользователь не зарегистрирован"}function B(){let t=document.querySelector('[data-error-log="login"]'),e=document.querySelector('[data-error-log="password"]');t.textContent=null,e.textContent=null}function $(t){t.preventDefault(),I()}document.addEventListener("DOMContentLoaded",function(){A.addEventListener("click",$),function(){let t=document.querySelector('[data-password-log="password"]');t.addEventListener("click",()=>M.type="password"===M.type?"text":"password")}()});const j=document.querySelector(".btnUp");window.addEventListener("scroll",function(){j.style.display=window.scrollY>0?"flex":"none"}),s("iOt5K");const H=document.querySelectorAll(".anim-item");function Q(){for(let t of H){let e=t.offsetHeight,r=function(t){let e=t.getBoundingClientRect(),r=window.scrollX||document.documentElement.scrollLeft,s=window.scrollY||document.documentElement.scrollTop;return{top:e.top+s,left:e.left+r}}(t).top,s=window.innerHeight-e/4;e>window.innerHeight&&(s=window.innerHeight-window.innerHeight/4),window.scrollY>r-s&&window.scrollY<r+e?t.classList.add("anim"):t.classList.contains("anim-no-hide")||t.classList.remove("anim")}}window.addEventListener("scroll",Q),setTimeout(()=>{Q()},300);
//# sourceMappingURL=index.ab707963.js.map
