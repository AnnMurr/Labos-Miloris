(()=>{var t={516:()=>{const t=document.querySelector(".btnUp");window.addEventListener("scroll",(function(){t.style.display=window.scrollY>0?"flex":"none"}))},693:()=>{const t=document.querySelectorAll(".anim-item");function e(){for(const e of t){const t=e,s=t.offsetHeight,a=n(t).top,o=4;let r=window.innerHeight-s/o;s>window.innerHeight&&(r=window.innerHeight-window.innerHeight/o),window.scrollY>a-r&&window.scrollY<a+s?t.classList.add("anim"):t.classList.contains("anim-no-hide")||t.classList.remove("anim")}}function n(t){const e=t.getBoundingClientRect(),n=window.scrollX||document.documentElement.scrollLeft,s=window.scrollY||document.documentElement.scrollTop;return{top:e.top+s,left:e.left+n}}window.addEventListener("scroll",e),setTimeout((()=>{e()}),300)}},e={};function n(s){var a=e[s];if(void 0!==a)return a.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,n),o.exports}(()=>{"use strict";let t=0,e=0;function s(n,s,a){const o=document.getElementById("body");"fixed"===n?(t=window.scrollY||document.documentElement.scrollTop,e=window.scrollX||document.documentElement.scrollLeft):window.scrollTo(e,t),o.style.position=n,o.style.width=s,o.style.overflowY=a}const a=document.querySelector(".burger"),o=document.querySelector(".submenu"),r=document.querySelector(".cross");function c(t){o.contains(t.target)||r.contains(t.target)||a.contains(t.target)||(o.classList.remove("submenu_active"),document.removeEventListener("click",c))}a.addEventListener("click",(function(){o.classList.contains("submenu_active")?(o.classList.remove("submenu_active"),document.removeEventListener("click",c)):(o.classList.add("submenu_active"),document.addEventListener("click",c),s("fixed","100%","scroll"))})),r.addEventListener("click",(()=>{o.classList.remove("submenu_active"),s(null,null,null)}));class i{static cardsUrl="https://64901aaa1e6aa71680ca93bb.mockapi.io/cards";static getCards(){return fetch(i.cardsUrl).then((t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()})).catch((t=>{throw t}))}static getWomenCards(){return fetch(i.cardsUrl).then((t=>t.json())).then((t=>{let e=[];return t.forEach((t=>{"women"===t.chapter&&e.push(t)})),e})).catch((t=>{throw t}))}static getMenCards(){return fetch(i.cardsUrl).then((t=>t.json())).then((t=>{let e=[];return t.forEach((t=>{"men"===t.chapter&&e.push(t)})),e})).catch((t=>{throw t}))}static getSelectiveCards(){return fetch(i.cardsUrl).then((t=>t.json())).then((t=>{let e=[];return t.forEach((t=>{"selective"===t.chapter&&e.push(t)})),e})).catch((t=>{throw t}))}}const d=document.querySelector(".basket-modal"),l=document.querySelector(".basket"),u=document.querySelector(".submenu__basket"),m=document.querySelector(".submenu");function p(){m.classList.contains("submenu_active")&&m.classList.remove("submenu_active"),d.classList.contains("basket-modal_active")?(d.classList.remove("basket-modal_active"),h()):(d.classList.add("basket-modal_active"),h())}function g(){d.classList.remove("basket-modal_active"),h(),s(null,null,null)}function b(t){d.contains(t.target)||l.contains(t.target)||t.target.classList.contains("cross")||t.target.classList.contains("basket-item-minus")||u.contains(t.target)||(d.classList.remove("basket-modal_active"),h())}function h(){const t=document.querySelector(".basket-modal .basket-modal__items"),e=document.querySelector(".basket-modal__footer");d.classList.contains("basket-modal_active")?document.addEventListener("click",b):(document.removeEventListener("click",b),t.innerHTML=null,e.innerHTML=null)}l.addEventListener("click",p),u.addEventListener("click",p);const _="basket",y="User";let f=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});const k=["Минск","Витебск","Брест","Гродно","Гомель","Могилев"];function w(t,e,n){const s=document.querySelector(".alert"),a=document.createElement("div");a.classList.add("alert__wrapper",`alert__wrapper_${t}`);const o=document.createElement("span");o.textContent=`${n} ${e}`;const r=document.createElement("span");r.classList.add("alert__line"),r.style.width="0",a.append(o,r),s.append(a),setTimeout((()=>r.style.width="100%"),100),setTimeout((()=>a.remove()),3e3)}class L{static error(t){w("error",t,"❌")}static warning(t){w("warning",t,"⚠️")}static success(t){w("success",t,"✅")}}class v{static setCardToStore(t){localStorage.setItem(_,JSON.stringify(t))}static getBasketStore(){return localStorage.getItem(_)}static basketStoreData(){const t=this.getBasketStore();return JSON.parse(t)||[]}}class E{static countElementsInBasket(){const t=v.basketStoreData();let e=0;return t.forEach((t=>{e+=Number(t.quantity)})),e}static changeBasketCount(){document.querySelector(".basket__count span").textContent=this.countElementsInBasket()}}class S{static setUserToken(t){return sessionStorage.setItem(y,t)}static getUserToken(){return sessionStorage.getItem(y)}static removeUserToken(){return sessionStorage.removeItem(y)}}function x(){S.getUserToken()?(s(null,null,null),L.success("Заказ успешно создан"),v.setCardToStore([]),g(),E.changeBasketCount()):L.warning("Авторизуйтесь, чтобы сделать заказ")}const q=document.querySelector(".basket-modal");document.addEventListener("DOMContentLoaded",(function(){q.append(function(){const t=document.createElement("div");t.classList.add("modal-header");const e=document.createElement("div");e.classList.add("modal-header__heading");const n=document.createElement("h3");n.textContent="Корзина";const s=document.createElement("button");return s.classList.add("cross"),s.type="button",s.addEventListener("click",g),e.append(n),t.append(e,s),t}(),function(){const t=document.createElement("div");return t.classList.add("basket-modal__items"),t.addEventListener("click",j),t}(),function(){const t=document.createElement("div");return t.classList.add("basket-modal__footer"),t}())}));const C=document.querySelector(".basket"),U=document.querySelector(".basket-modal"),T=document.querySelector(".submenu__basket");let N;function M(){const t=v.basketStoreData();let e=0;return t.forEach((t=>e+=+t.price)),e}function D(){document.querySelector(".basket-modal__general-price span").textContent=`Итого: ${f.format(M())}`}function O(){const t=v.basketStoreData(),e=document.querySelector(".basket-modal .basket-modal__items"),n=document.querySelector(".basket-modal__footer"),s=M();U.classList.contains("basket-modal_active")&&(t.forEach((t=>e.append(function(t){const e=document.createElement("div");return e.classList.add("basket-item"),e.id=t.id,e.append(function(t){const e=document.createElement("div");e.classList.add("basket-item__title");const n=document.createElement("h5");return n.textContent=`${t.title}`,e.append(n),n}(t),function(t){const e=document.createElement("div");e.classList.add("basket-item__count");const n=document.createElement("button");n.type="button",n.classList.add("basket-item-minus"),n.textContent="-";const s=document.createElement("span");s.classList.add("basket-item-quantity"),s.textContent=t.quantity;const a=document.createElement("button");return a.type="button",a.classList.add("basket-item-plus"),a.textContent="+",a.addEventListener("click",I),n.addEventListener("click",I),e.append(n,s,a),e}(t),function(t){const e=document.createElement("div");e.classList.add("basket-item__price");const n=document.createElement("span");return n.textContent=`${f.format(t.price)}`,e.append(n),e}(t),function(){const t=document.createElement("button");return t.classList.add("cross","cross_small"),t}()),e}(t)))),n.append(function(){const t=document.createElement("div");t.classList.add("basket-modal__buttons");const e=document.createElement("button");e.classList.add("basket-modal__delite-all"),e.type="button",e.textContent="Очистить корзину",e.addEventListener("click",H);const n=document.createElement("button");return n.classList.add("btn","basket-modal__order"),n.type="button",n.textContent="Заказать",n.addEventListener("click",x),t.append(e,n),t}(),function(t){const e=document.createElement("div");e.classList.add("basket-modal__general-price");const n=document.createElement("span");return n.textContent=`Итого: ${f.format(t)}`,e.append(n),e}(s)),Y())}function I(t){const e=t.target.parentNode.parentNode,n=e.querySelector(".basket-item__price"),s=v.basketStoreData(),a=s.find((t=>t.id===e.id)),o=N.find((t=>t.id===e.id));let r=s;a&&(t.target.classList.contains("basket-item-minus")?1===Number(a.quantity)?(r=s.filter((t=>t.id!==a.id)),e.remove(),0===r.length&&Y()):(B(a,o,"-"),A(t.target,a,n)):(B(a,o,"+"),A(t.target,a,n))),v.setCardToStore(r),D(),E.changeBasketCount()}function A(t,e,n){(t.classList.contains("basket-item-minus")?t.nextElementSibling:t.previousElementSibling).textContent=e.quantity,n.textContent=`${f.format(e.price)}`}function B(t,e,n){let s="-"===n;return t.quantity=(s?Number(t.quantity)-1:Number(t.quantity)+1).toString(),t.price=(s?Number(t.price)-Number(e.price):Number(t.price)+Number(e.price)).toString(),t.quantity&&t.price}function $(t){const e=v.basketStoreData(),n=t.target.parentNode.parentNode.parentNode.id;let s=[];const a=N.find((t=>t.id===n));if(e){s=e;const t=s.find((t=>t.id===n));t?B(t,a,"+"):s.push(a)}else s.push(a);v.setCardToStore(s),E.changeBasketCount(),L.success("Товар добавлен в корзину")}function j(t){const e=t.target.parentNode,n=v.basketStoreData().filter((t=>e.id!==t.id));v.setCardToStore(n),t.target.classList.contains("cross")&&(e.remove(),Y(),D(),E.changeBasketCount())}function H(){document.querySelector(".basket-modal .basket-modal__items").textContent="Корзина пуста",v.setCardToStore([]),Y(),E.changeBasketCount()}function Y(){const t=document.querySelector(".basket-modal__footer"),e=document.querySelector(".basket-modal .basket-modal__items");document.querySelector(".basket-item")?t.style.display="flex":(t.style.display="none",e.textContent="Корзина пуста")}document.addEventListener("DOMContentLoaded",(function(){!async function(){N=await i.getCards()}(),C.addEventListener("click",O),!document.querySelector(".basket__count")&&C.append(function(){const t=document.createElement("div");t.classList.add("basket__count");const e=document.createElement("span");return e.textContent=E.countElementsInBasket(),t.append(e),t}()),T.addEventListener("click",O),setTimeout((()=>(()=>{const t=document.querySelectorAll(".card-btn");t&&t.forEach((t=>t.addEventListener("click",$)))})()),1e3)}));const P=[{tag:"input",class:"registration__input",id:"city",attributes:[{type:"text"},{placeholder:"Город"},{list:"city-list"},{autocomplete:"address-level2"},{"data-input":"city"}]},{tag:"datalist",id:"city-list"},{tag:"span",class:["error-message"],id:"error-city",attributes:[{"data-error":"city"}]},{tag:"input",class:"registration__input",attributes:[{type:"text"},{placeholder:"Имя"},{autocomplete:"given-name"},{"data-input":"name"}]},{tag:"span",class:["error-message"],id:"error-name",attributes:[{"data-error":"name"}]},{tag:"input",id:"birthday",class:"registration__input",attributes:[{type:"date"},{placeholder:"Дата рождения"},{autocomplete:"bday"},{name:"trip-start"},{min:"1900-01-01"},{"data-input":"date"}]},{tag:"span",class:["error-message"],id:"error-date",attributes:[{"data-error":"date"}]},{tag:"input",class:"registration__input",attributes:[{type:"email"},{placeholder:"Почта"},{autocomplete:"email"},{"data-input":"email"}]},{tag:"span",class:["error-message"],id:"error-email",attributes:[{"data-error":"email"}]},{tag:"input",class:"registration__input",attributes:[{type:"password"},{placeholder:"Пароль"},{autocomplete:"current-password"},{"data-input":"password-1"}]},{tag:"button",class:"btn-show-password",attributes:[{"data-password":"password-1"},{type:"button"}],content:"👁"},{tag:"span",id:"error-password",class:["error-message"],attributes:[{"data-error":"password-1"}]},{tag:"input",class:"registration__input",attributes:[{type:"password"},{placeholder:"Введите пароль еще раз"},{autocomplete:"current-password"},{"data-input":"password-2"}]},{tag:"button",class:"btn-show-password",attributes:[{"data-password":"password-2"},{type:"button"}],content:"👁"},{tag:"span",class:["error-message"],attributes:[{"data-error":"password-2"}]},{tag:"input",id:"registration__checkbox",class:["registration__input","registration__checkbox"],attributes:[{type:"checkbox"},{"data-input":"checkbox"}]},{tag:"a",class:["registration__label"],content:"Согласен с политикой конфиденциальности"},{tag:"span",class:["error-message"],attributes:[{"data-error":"checkbox"}]},{tag:"button",class:["btn","registration__button"],content:"Зарегистрироваться",attributes:[{type:"submit"}]}];class F{static passwordDossNotMatch="Пароль не совпадает";static passwordIncorrectLength="Пароль должен содержать не менее 6 символов и одну заглавную букву";static chooseAnotherCity="Выберите другой город";static whiteSpace="Строки не должны содержать пробелы";static invalidEmail="Неправильно введенный e-mail";static errorMessageMaxQuantity(t,e,n){t.textContent=`Имя не должно содержать ${n}\nМаксимальное кол-во ${e} символов`}static errorMessageExistingLogin(t,e){t.textContent=`Пользователь ${e} уже существует`}static setErrorMessage(t,e){t.textContent=e}}class J{static userUrl="https://64901aaa1e6aa71680ca93bb.mockapi.io/user";static setUserData(t,e,n,s,a,o,r){return new Promise(((c,i)=>{fetch(this.userUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:t,password:e,token:n,city:s,name:a,date:o,orders:r})}).then((t=>{t.ok?c():i()})).catch((t=>{throw t}))}))}static async changeUserOrders(t,e){const n=await this.getUserToken(t),s=n.id;return n.orders=e,fetch(`${this.userUrl}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((t=>{if(t.ok)return t.json();throw new Error("Failed to change user data")})).catch((t=>{throw t}))}static getUserData(t){return fetch(this.userUrl).then((t=>t.json())).then((e=>e.find((e=>e.login===t)))).catch((t=>{throw t}))}static getUserLogin(t){return fetch(this.userUrl).then((t=>t.json())).then((e=>e.find((e=>e.login===t)))).catch((t=>{throw t}))}static getUserToken(t){return fetch(this.userUrl).then((t=>t.json())).then((e=>e.find((e=>e.token.toString()===t)))).catch((t=>{throw t}))}}class Q{static specialSymbolsArray=/[!@#$%^&*()[\]{}|\\;:'"<>.,\/?`~=+\-№_]/;static specialSymbols="!@#$%^&*()-_+={}[]|\\;:'\"<>.,/?`~№";static maxNumberOfLettersName=20;static maxNumberOfLettersEmail=40;static minNumberOfLettersPasswords=6;static token=Math.random()*new Date;static successRegistration="Регистрация прошла успешно"}class R{static signOut="Выйти из акаунта";static signIn="Войти";static welcomeUser=t=>`Добро пожаловать, ${t}`;static welcome="Добро пожаловать!"}function X(){const t=S.getUserToken();document.querySelector(".authentication__sign-up").style.display=t?"none":"block"}X();const V=document.querySelector(".user"),W=document.querySelector(".submenu__user"),Z=document.querySelector(".user__modal");function z(){Z.classList.contains("user__modal_active")?Z.classList.remove("user__modal_active"):Z.classList.add("user__modal_active"),K()}function G(){Z.classList.remove("user__modal_active"),K(),s(null,null,null)}function K(){Z.classList.contains("user__modal_active")?document.addEventListener("click",tt):document.removeEventListener("click",tt)}function tt(t){!Z.contains(t.target)&&!V.contains(t.target)&&!W.contains(t.target)&&Z.classList.remove("user__modal_active"),!Z.classList.contains("user__modal_active")&&document.removeEventListener("click",tt)}async function et(){Z.innerHTML=null;const t=S.getUserToken(),e=await J.getUserToken(t);t?nt(R.welcomeUser(e.name),R.signOut):nt(R.welcome,R.signIn)}function nt(t,e){Z.append(function(t){const e=document.createElement("div");e.classList.add("modal-header");const n=document.createElement("div");n.classList.add("modal-header__heading");const s=document.createElement("h5");s.textContent=t;const a=document.createElement("button");return a.classList.add("cross"),a.type="button",a.addEventListener("click",G),n.append(s),e.append(n,a),e}(t),function(t=R.signOut){const e=document.createElement("button");return e.classList.add("btn","user__btn-exit"),e.textContent=t,e.addEventListener("click",st),e}(e))}async function st(){const t=S.getUserToken(),e=v.basketStoreData(),n=await J.getUserToken(t);if(t)J.changeUserOrders(n.token.toString(),e),X(),setTimeout((()=>(S.removeUserToken(),v.setCardToStore([]),void location.reload())),1e3);else{const t=document.getElementById("authentication");s(null,null,null),t.scrollIntoView({behavior:"smooth"}),Z.classList.remove("user__modal_active")}}V.addEventListener("click",z),W.addEventListener("click",z),document.addEventListener("DOMContentLoaded",et);const at=document.querySelector(".registration");function ot(){const t=document.createElement("div");t.classList.add("registration__wrapper"),t.append(function(){const t=document.createElement("div");return t.classList.add("registration__image-inner"),t}(),function(){const t=document.createElement("form");return t.classList.add("registration__form"),function(t){P.forEach((e=>{const n=document.createElement(e.tag);var s;if(Array.isArray(e.class)&&e.class.length>0?e.class.forEach((t=>n.classList.add(t))):e.class&&n.classList.add(e.class),e.attributes&&e.attributes.length>0&&e.attributes.forEach((t=>{const[e,s]=Object.entries(t)[0];n.setAttribute(e,s)})),e.id&&"city-list"===e.id?(n.id=e.id,s=n,k.forEach((t=>{const e=document.createElement("option");e.textContent=t,s.appendChild(e)}))):e.id&&(n.id=e.id),"date"===n.getAttribute("type")){n.addEventListener("keydown",(function(t){t.preventDefault()}));let t=new Date;t.setFullYear(t.getFullYear()-18),n.setAttribute("max",t.toISOString().split("T")[0])}e.content&&(n.textContent=e.content),t.append(n)}))}(t),t}()),at.append(t),t.querySelector(".registration__label").addEventListener("click",ct),document.querySelector(".registration__button").addEventListener("click",rt)}function rt(t){t.preventDefault(),async function(){document.querySelectorAll(".error-message").forEach((t=>t.textContent=null));const t=Array.from(document.querySelectorAll(".registration__input"));let e=t.map((t=>t.value));const[n,s,a,o,r,c]=e,i=document.getElementById("error-city"),d=document.getElementById("error-name"),l=document.getElementById("error-email"),u=document.querySelector('[data-error="password-1"]'),m=await J.getUserLogin(o),p=v.basketStoreData();it(t).includes(!1)?it(t):k.includes(n)?s.includes(" ")?F.setErrorMessage(d,F.whiteSpace):o.includes(" ")?F.setErrorMessage(l,F.whiteSpace):r.includes(" ")?F.setErrorMessage(u,F.whiteSpace):s.length>Q.maxNumberOfLettersName||s.match(Q.specialSymbolsArray)?F.errorMessageMaxQuantity(d,Q.maxNumberOfLettersName,Q.specialSymbols):/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(o)?o.length>Q.maxNumberOfLettersEmail?F.errorMessageMaxQuantity(l,Q.maxNumberOfLettersEmail):m?F.errorMessageExistingLogin(l,o):r!==c?F.setErrorMessage(u,F.passwordDossNotMatch):r.length<Q.minNumberOfLettersPasswords||!r.match(/[A-ZА-Я]/i)?F.setErrorMessage(u,F.passwordIncorrectLength):(J.setUserData(o,r,Q.token,n,s,a,p),L.success(Q.successRegistration),S.setUserToken(Q.token),X(),setTimeout((()=>{et(),location.reload()}),4e3)):F.setErrorMessage(l,F.invalidEmail):F.setErrorMessage(i,F.chooseAnotherCity)}()}function ct(){const t=document.querySelector(".registration__label");window.location.href,t.href="./privacy-policy.html"}document.querySelector(".authentication__sign-up").addEventListener("click",(()=>{at.classList.add("registration_active"),s("fixed","100%","scroll")}));const it=t=>{let e=[];return t.forEach((t=>{let n=t.getAttribute("data-input"),s=document.querySelector(`[data-error="${n}"]`);"checkbox"!==n||t.checked?""===t.value?(s.textContent="Поле должно быть заполнено",e.push(!1)):e.push(!0):(s.textContent="Подтвердите согласие",e.push(!1))})),e};document.addEventListener("DOMContentLoaded",(function(){ot(),function(){const t=document.querySelector('[data-input="password-1"]'),e=document.querySelector('[data-input="password-2"]'),n=document.querySelector('[data-password="password-1"]'),s=document.querySelector('[data-password="password-2"]');document.querySelectorAll("[data-password]").forEach((a=>{a.addEventListener("click",(function(a){const o="btn-show-password_show";let r="password-1"===a.target.getAttribute("data-password"),c=r?t:e;c.type="password"===c.type?"text":"password";let i=r?n:s;i.classList.contains(o)?i.classList.remove(o):i.classList.add(o)}))}))}()}));const dt=document.querySelector(".signIn__input-login"),lt=document.querySelector(".signIn__inputp-password"),ut=document.querySelector(".authentication .form .btn"),mt=document.querySelector(".authentication .form");function pt(){const t=document.querySelector('[data-error-log="login"]'),e=document.querySelector('[data-error-log="password"]');t.textContent=null,e.textContent=null}function gt(t){t.preventDefault(),async function(){pt();const t=await J.getUserData(dt.value),e=document.querySelector('[data-error-log="login"]'),n=document.querySelector('[data-error-log="password"]');S.getUserToken()?L.error("Выйдите из аккаунта"):t?t.password!==lt.value?n.textContent="Неверный пароль":(L.success("Вы вошли в аккаунт"),X(),S.setUserToken(t.token),et(),mt.reset(),pt(),v.setCardToStore(t.orders),E.changeBasketCount()):e.textContent="Пользователь не зарегистрирован"}()}document.addEventListener("DOMContentLoaded",(function(){ut.addEventListener("click",gt),function(){const t=document.querySelector('[data-password-log="password"]'),e="btn-show-password_show";t.addEventListener("click",(()=>{lt.type="password"===lt.type?"text":"password",t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)}))}()})),n(516),n(693)})()})();