(()=>{"use strict";var e={657:(e,t,n)=>{n.d(t,{$:()=>s});class s{static userUrl="https://64901aaa1e6aa71680ca93bb.mockapi.io/user";static setUserData(e,t,n,s,r,o,a){return new Promise(((c,i)=>{fetch(this.userUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:e,password:t,token:n,city:s,name:r,date:o,orders:a})}).then((e=>{e.ok?c():i()})).catch((e=>{throw e}))}))}static async changeUserOrders(e,t){const n=await this.getUserToken(e),s=n.id;return n.orders=t,fetch(`${this.userUrl}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(e.ok)return e.json();throw new Error("Failed to change user data")})).catch((e=>{throw e}))}static getUserData(e){return fetch(this.userUrl).then((e=>e.json())).then((t=>t.find((t=>t.login===e)))).catch((e=>{throw e}))}static getUserLogin(e){return fetch(this.userUrl).then((e=>e.json())).then((t=>t.find((t=>t.login===e)))).catch((e=>{throw e}))}static getUserToken(e){return fetch(this.userUrl).then((e=>e.json())).then((t=>t.find((t=>t.token.toString()===e)))).catch((e=>{throw e}))}}},64:(e,t,n)=>{n.d(t,{G$:()=>r,e0:()=>s});const s="basket",r="User";new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"})},324:(e,t,n)=>{n.d(t,{C:()=>r});var s=n(780);function r(){const e=s.U.getUserToken();document.querySelector(".authentication__sign-up").style.display=e?"none":"block"}r()},565:(e,t,n)=>{n.d(t,{h:()=>r});var s=n(64);class r{static setCardToStore(e){localStorage.setItem(s.e0,JSON.stringify(e))}static getBasketStore(){return localStorage.getItem(s.e0)}static basketStoreData(){const e=this.getBasketStore();return JSON.parse(e)||[]}}},780:(e,t,n)=>{n.d(t,{U:()=>r});var s=n(64);class r{static setUserToken(e){return sessionStorage.setItem(s.G$,e)}static getUserToken(){return sessionStorage.getItem(s.G$)}static removeUserToken(){return sessionStorage.removeItem(s.G$)}}}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(780);class t{static signOut="Выйти из акаунта";static signIn="Войти";static welcomeUser=e=>`Добро пожаловать, ${e}`;static welcome="Добро пожаловать!"}var s=n(657),r=n(565),o=n(324);const a=document.querySelector(".user"),c=document.querySelector(".user__modal");function i(){c.classList.remove("user__modal_active"),d()}function d(){c.classList.contains("user__modal_active")?document.addEventListener("click",u):document.removeEventListener("click",u)}function u(e){!c.contains(e.target)&&!a.contains(e.target)&&c.classList.remove("user__modal_active"),!c.classList.contains("user__modal_active")&&document.removeEventListener("click",u)}function l(e,n){c.append(function(e){const t=document.createElement("div");t.classList.add("modal-header");const n=document.createElement("div");n.classList.add("modal-header__heading");const s=document.createElement("h5");s.textContent=e;const r=document.createElement("button");return r.classList.add("cross"),r.type="button",r.addEventListener("click",i),n.append(s),t.append(n,r),t}(e),function(e=t.signOut){const n=document.createElement("button");return n.classList.add("btn","user__btn-exit"),n.textContent=e,n.addEventListener("click",m),n}(n))}async function m(){const t=e.U.getUserToken(),n=r.h.basketStoreData(),a=await s.$.getUserToken(t);t?(s.$.changeUserOrders(a.token.toString(),n),(0,o.C)(),setTimeout((()=>(e.U.removeUserToken(),r.h.setCardToStore([]),void location.reload())),1e3)):(document.getElementById("authentication").scrollIntoView({behavior:"smooth"}),c.classList.remove("user__modal_active"))}a.addEventListener("click",(function(){c.classList.toggle("user__modal_active"),d()})),document.addEventListener("DOMContentLoaded",(async function(){c.innerHTML=null;const n=e.U.getUserToken(),r=await s.$.getUserToken(n);n?l(t.welcomeUser(r.name),t.signOut):l(t.welcome,t.signIn)}))})()})();